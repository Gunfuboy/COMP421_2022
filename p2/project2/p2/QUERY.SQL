-- Q5 --

-- a)
SELECT ADATE, ATIME, M.MOMRAMQ, NAME, PHONE
FROM APPOINTMENTS JOIN MOTHER M ON APPOINTMENTS.MOMRAMQ = M.MOMRAMQ
WHERE ADATE >= '2022-03-21' AND ADATE <= '2022-03-25'
AND PRACTID = (SELECT PRACTID FROM MIDWIFE WHERE MIDWIFE.NAME = 'Marion Girard');

-- b)
SELECT DATEDONE , IRONLEVEL
FROM PREGNANCY_RESULT P LEFT OUTER JOIN TESTS T ON P.RESULTID = T.RESULTID
WHERE LOGINID =
      (SELECT LOGINID FROM COUPLE WHERE MOMRAMQ =
                                        (SELECT MOMRAMQ FROM MOTHER WHERE NAME = 'Victoria Gutierrez'))
AND TYPE = 'Blood Test'
AND NUMBERPREGANCY = 2
;

-- c)
WITH FACILITIES (NAME,EMAIL) AS
    (SELECT NAME,EMAIL FROM INSTITUTIONS WHERE
        EMAIL IN (SELECT EMAIL FROM FACILITY))
SELECT NAME, COUNT(CASE WHEN EXPECTDUEDATE BETWEEN '2022-07-01' AND '2022-07-31' THEN LOGINID END) AS NUM_OF_PREGNANCIES
FROM FACILITIES F LEFT JOIN PREGNANCY_RESULT P ON P.EMAIL = F.EMAIL
GROUP BY NAME;


-- d)
SELECT M.MOMRAMQ, NAME, PHONE
FROM PREGNANCY_RESULT
    FULL OUTER JOIN COUPLE C2 on PREGNANCY_RESULT.LOGINID = C2.LOGINID
    FULL OUTER JOIN MOTHER M on C2.MOMRAMQ = M.MOMRAMQ
WHERE PRACTID IN (SELECT PRACTID FROM MIDWIFE WHERE MIDWIFE.EMAIL =
                                                    (SELECT EMAIL FROM INSTITUTIONS WHERE
                                                        NAME = 'Lac-Saint-Louis'))
AND EXPECTDUEDATE > '2022-02-24'
;

-- e)
SELECT C2.MOMRAMQ, NAME, C2.LOGINID
FROM PREGNANCY_RESULT FULL OUTER JOIN COUPLE C2 on PREGNANCY_RESULT.LOGINID = C2.LOGINID
                    FULL OUTER JOIN MOTHER M on C2.MOMRAMQ = M.MOMRAMQ
WHERE NUMOFBABIES >= 2
;

